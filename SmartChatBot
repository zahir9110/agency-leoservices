import React, { useState, useRef, useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { 
  MessageCircle, 
  X, 
  Send, 
  Bot, 
  User,
  Loader2,
  Sparkles,
  ArrowRight,
  Calculator,
  FileText,
  Briefcase,
  Mail,
  HelpCircle
} from 'lucide-react';
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { base44 } from '@/api/base44Client';
import { createPageUrl } from '@/utils';
import { Link } from 'react-router-dom';

// Track user journey
const useUserJourney = () => {
  const [journey, setJourney] = useState(() => {
    const saved = sessionStorage.getItem('userJourney');
    return saved ? JSON.parse(saved) : {
      pagesVisited: [],
      timeOnSite: 0,
      interactions: 0,
      interests: [],
      hasUsedROI: false,
      hasViewedServices: false,
      hasViewedPricing: false
    };
  });

  useEffect(() => {
    const currentPage = window.location.pathname.split('/').pop() || 'Home';
    setJourney(prev => {
      const updated = {
        ...prev,
        pagesVisited: [...new Set([...prev.pagesVisited, currentPage])],
        interactions: prev.interactions + 1
      };
      sessionStorage.setItem('userJourney', JSON.stringify(updated));
      return updated;
    });
  }, []);

  const trackInterest = (interest) => {
    setJourney(prev => {
      const updated = {
        ...prev,
        interests: [...new Set([...prev.interests, interest])]
      };
      sessionStorage.setItem('userJourney', JSON.stringify(updated));
      return updated;
    });
  };

  const trackAction = (action) => {
    setJourney(prev => {
      const updated = { ...prev, [action]: true };
      sessionStorage.setItem('userJourney', JSON.stringify(updated));
      return updated;
    });
  };

  return { journey, trackInterest, trackAction };
};

const getContextualQuickReplies = (journey) => {
  const baseReplies = [
    { text: "Quels sont vos services?", action: "services", icon: Briefcase },
    { text: "Calculer mon ROI", action: "roi", icon: Calculator },
  ];

  if (!journey.hasViewedServices) {
    baseReplies.push({ text: "Voir les tarifs", action: "pricing", icon: FileText });
  }
  
  if (journey.pagesVisited.length > 2) {
    baseReplies.push({ text: "Parler √† un expert", action: "contact", icon: Mail });
  } else {
    baseReplies.push({ text: "Comment √ßa marche?", action: "process", icon: HelpCircle });
  }

  return baseReplies.slice(0, 4);
};

const getWelcomeMessage = (journey) => {
  if (journey.pagesVisited.length > 3) {
    return "Ravi de vous revoir! üëã Vous semblez int√©ress√© par nos solutions. Puis-je vous aider √† finaliser votre choix ou r√©pondre √† des questions sp√©cifiques?";
  }
  if (journey.hasUsedROI) {
    return "Excellent! Vous avez d√©j√† calcul√© vos √©conomies potentielles. Souhaitez-vous discuter d'une solution personnalis√©e pour votre entreprise?";
  }
  if (journey.hasViewedServices) {
    return "Bonjour! üëã Je vois que vous avez consult√© nos services. Avez-vous des questions sur une solution en particulier?";
  }
  return "Bonjour! üëã Je suis l'assistant IA d'Agency Leo Services, votre partenaire technologique pour une croissance durable. Comment puis-je vous aider √† automatiser et optimiser vos processus?";
};

export default function SmartChatBot() {
  const { journey, trackInterest, trackAction } = useUserJourney();
  const [isOpen, setIsOpen] = useState(false);
  const [hasShownProactiveMessage, setHasShownProactiveMessage] = useState(false);
  const [messages, setMessages] = useState([]);
  const [inputValue, setInputValue] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const messagesEndRef = useRef(null);
  const inputRef = useRef(null);

  // Initialize with contextual welcome message
  useEffect(() => {
    if (messages.length === 0) {
      setMessages([{
        role: 'assistant',
        content: getWelcomeMessage(journey),
        quickReplies: getContextualQuickReplies(journey)
      }]);
    }
  }, []);

  // Proactive engagement after 30 seconds
  useEffect(() => {
    if (!hasShownProactiveMessage && !isOpen) {
      const timer = setTimeout(() => {
        if (journey.pagesVisited.length >= 2 && !isOpen) {
          setHasShownProactiveMessage(true);
        }
      }, 30000);
      return () => clearTimeout(timer);
    }
  }, [journey.pagesVisited, isOpen, hasShownProactiveMessage]);

  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
  };

  useEffect(() => {
    scrollToBottom();
  }, [messages]);

  useEffect(() => {
    if (isOpen && inputRef.current) {
      inputRef.current.focus();
    }
  }, [isOpen]);

  const saveProspectInteraction = async (interest) => {
    try {
      const existingProspect = sessionStorage.getItem('prospectId');
      if (!existingProspect) {
        trackInterest(interest);
      }
    } catch (error) {
      // Silent fail
    }
  };

  const handleQuickReply = async (action) => {
    const responses = {
      services: {
        userMessage: "Quels sont vos services?",
        botResponse: `Nous proposons des solutions d'automatisation IA compl√®tes:

ü§ñ **Chatbots IA 24/7** - R√©pondez instantan√©ment sur WhatsApp, Messenger, site web

‚ö° **Automatisation des Flux** - Connectez vos outils avec n8n, Make, Zapier

üìÖ **Gestion de Rendez-vous** - Automatisez la prise de RDV et rappels

üìà **Prospection Automatis√©e** - G√©n√©rez des leads qualifi√©s

üí¨ **Service Client Automatis√©** - Support sans augmenter vos effectifs

üîó **Int√©grations Sur-Mesure** - Connectez tous vos outils

Quel service vous int√©resse le plus?`,
        trackAs: 'hasViewedServices',
        nextReplies: [
          { text: "Chatbots IA", action: "chatbot_detail", icon: Bot },
          { text: "Automatisation", action: "automation_detail", icon: Sparkles },
          { text: "Voir les tarifs", action: "pricing", icon: FileText },
          { text: "Calculer mon ROI", action: "roi", icon: Calculator }
        ]
      },
      pricing: {
        userMessage: "Quels sont vos tarifs?",
        botResponse: `Nos offres s'adaptent √† vos besoins:

üíº **Starter** - 500$/mois
‚Ä¢ 1 chatbot ou automatisation
‚Ä¢ Support par email
‚Ä¢ Id√©al pour d√©marrer

üöÄ **Business** - 1200$/mois ‚≠ê Populaire
‚Ä¢ Jusqu'√† 5 automatisations
‚Ä¢ Support prioritaire
‚Ä¢ Int√©grations avanc√©es

üè¢ **Enterprise** - Sur mesure
‚Ä¢ Solutions illimit√©es
‚Ä¢ Support d√©di√© 24/7
‚Ä¢ D√©veloppement personnalis√©

‚úÖ **Consultation gratuite** pour analyser vos besoins!`,
        trackAs: 'hasViewedPricing',
        showContactButton: true,
        navigateTo: 'Services'
      },
      roi: {
        userMessage: "Je veux calculer mon ROI",
        botResponse: `Excellente id√©e! üìä 

Notre calculatrice ROI vous permet d'estimer vos √©conomies potentielles bas√©es sur:
‚Ä¢ Nombre d'employ√©s concern√©s
‚Ä¢ Heures pass√©es sur des t√¢ches r√©p√©titives
‚Ä¢ Co√ªt horaire moyen

En moyenne, nos clients √©conomisent **70% du temps** sur les t√¢ches automatis√©es.

Je vous invite √† utiliser notre calculatrice interactive sur la page d'accueil!`,
        trackAs: 'hasUsedROI',
        scrollTo: 'roi-calculator',
        nextReplies: [
          { text: "Voir la calculatrice", action: "scroll_roi", icon: Calculator },
          { text: "Parler √† un expert", action: "contact", icon: Mail }
        ]
      },
      process: {
        userMessage: "Comment √ßa marche?",
        botResponse: `Notre processus est simple et efficace:

**1Ô∏è‚É£ Consultation Gratuite** (30 min)
Analyse de vos besoins et identification des opportunit√©s

**2Ô∏è‚É£ Proposition Sur-Mesure** (2-3 jours)
Solution personnalis√©e avec devis d√©taill√©

**3Ô∏è‚É£ Configuration** (1-3 semaines)
Notre √©quipe configure tout pour vous

**4Ô∏è‚É£ Formation & Support**
D√©monstration compl√®te + support continu

Vous n'avez rien √† faire techniquement, on s'occupe de tout! üéØ`,
        nextReplies: [
          { text: "R√©server ma consultation", action: "contact", icon: Mail },
          { text: "Voir les services", action: "services", icon: Briefcase }
        ]
      },
      contact: {
        userMessage: "Je souhaite parler √† un expert",
        botResponse: `Parfait! üéØ 

Nos experts sont disponibles pour une **consultation gratuite de 30 minutes**.

üìß Email: agency-leoservices@zohomailcloud.ca

Ou remplissez le formulaire de contact pour une r√©ponse sous 24h.

Je vous redirige vers la page contact...`,
        scrollToContact: true,
        navigateTo: 'Contact'
      },
      chatbot_detail: {
        userMessage: "Parlez-moi des chatbots IA",
        botResponse: `Nos **Chatbots IA** sont con√ßus pour:

‚úÖ R√©pondre 24/7 √† vos clients
‚úÖ Qualifier les prospects automatiquement
‚úÖ Prendre des rendez-vous
‚úÖ R√©pondre aux FAQ
‚úÖ Transf√©rer vers un humain si n√©cessaire

**Plateformes support√©es:**
‚Ä¢ WhatsApp Business
‚Ä¢ Facebook Messenger
‚Ä¢ Instagram DM
‚Ä¢ Site web (widget)

**R√©sultats moyens:**
üìâ -60% d'appels entrants
‚è±Ô∏è Temps de r√©ponse < 5 secondes
üòä +40% satisfaction client

Voulez-vous voir une d√©mo ou obtenir un devis?`,
        nextReplies: [
          { text: "Obtenir un devis", action: "contact", icon: Mail },
          { text: "Voir les tarifs", action: "pricing", icon: FileText }
        ]
      },
      automation_detail: {
        userMessage: "Parlez-moi de l'automatisation",
        botResponse: `Notre expertise en **Automatisation** couvre:

üîÑ **Flux de travail**
‚Ä¢ Synchronisation de donn√©es entre outils
‚Ä¢ Notifications automatiques
‚Ä¢ Rapports automatis√©s

üìß **Email & Communication**
‚Ä¢ S√©quences email personnalis√©es
‚Ä¢ Relances automatiques
‚Ä¢ Newsletters segment√©es

üìä **Gestion de donn√©es**
‚Ä¢ Import/export automatique
‚Ä¢ Nettoyage de donn√©es
‚Ä¢ Tableaux de bord temps r√©el

**Outils utilis√©s:** n8n, Make, Zapier, APIs personnalis√©es

En moyenne: **15-20h/semaine √©conomis√©es** par entreprise!`,
        nextReplies: [
          { text: "Calculer mon ROI", action: "roi", icon: Calculator },
          { text: "Parler √† un expert", action: "contact", icon: Mail }
        ]
      },
      scroll_roi: {
        userMessage: "Voir la calculatrice ROI",
        botResponse: "Je vous emm√®ne vers notre calculatrice ROI! üìä",
        scrollTo: 'roi-calculator',
        closeAfter: true
      }
    };

    const response = responses[action];
    if (response) {
      setMessages(prev => [...prev, { role: 'user', content: response.userMessage }]);
      
      if (response.trackAs) {
        trackAction(response.trackAs);
      }
      
      saveProspectInteraction(action);

      setIsLoading(true);
      await new Promise(resolve => setTimeout(resolve, 600));
      
      setMessages(prev => [...prev, { 
        role: 'assistant', 
        content: response.botResponse,
        quickReplies: response.nextReplies,
        showContactButton: response.showContactButton,
        navigateTo: response.navigateTo
      }]);
      setIsLoading(false);

      if (response.scrollTo) {
        setTimeout(() => {
          document.getElementById(response.scrollTo)?.scrollIntoView({ behavior: 'smooth' });
          if (response.closeAfter) {
            setIsOpen(false);
          }
        }, 1000);
      }

      if (response.scrollToContact) {
        setTimeout(() => {
          document.getElementById('contact')?.scrollIntoView({ behavior: 'smooth' });
        }, 1500);
      }
    }
  };

  const handleSendMessage = async () => {
    if (!inputValue.trim() || isLoading) return;

    const userMessage = inputValue.trim();
    setInputValue('');
    setMessages(prev => [...prev, { role: 'user', content: userMessage }]);
    setIsLoading(true);

    try {
      const journeyContext = `
Parcours utilisateur:
- Pages visit√©es: ${journey.pagesVisited.join(', ')}
- A vu les services: ${journey.hasViewedServices ? 'Oui' : 'Non'}
- A vu les tarifs: ${journey.hasViewedPricing ? 'Oui' : 'Non'}
- A utilis√© le calculateur ROI: ${journey.hasUsedROI ? 'Oui' : 'Non'}
- Int√©r√™ts d√©tect√©s: ${journey.interests.join(', ') || 'Non d√©finis'}
`;

      const response = await base44.integrations.Core.InvokeLLM({
        prompt: `Tu es l'assistant IA d'Agency Leo Services, une agence de consulting et d'automatisation IA sp√©cialis√©e dans la croissance des PME et des agences √† Montr√©al.

${journeyContext}

SERVICES PROPOS√âS:
- Chatbots IA 24/7 (WhatsApp, Messenger, site web)
- Automatisation des flux (n8n, Make, Zapier)
- Gestion de rendez-vous automatis√©e
- Prospection automatis√©e
- Service client automatis√©
- Int√©grations sur-mesure

TARIFS:
- Starter: 500$/mois (1 solution)
- Business: 1200$/mois (jusqu'√† 5 solutions) - Le plus populaire
- Enterprise: Sur mesure

INFORMATIONS:
- D√©lai de mise en place: 1-3 semaines
- Consultation gratuite disponible
- Contact: agency-leoservices@zohomailcloud.ca
- Adresse: Montr√©al, QC, Canada

MISSION: Permettre aux entreprises de se concentrer sur leur c≈ìur de m√©tier pendant que l'IA s'occupe du reste.

POINTS CL√âS √Ä COMMUNIQUER:
- L'IA n'est plus r√©serv√©e aux grandes entreprises, elle est accessible et puissante pour les PME
- Les entreprises qui automatisent gagnent en vitesse, scalabilit√© et stabilit√©
- On transforme les op√©rations traditionnelles en syst√®mes intelligents
- ROI rapide et mesurable sur chaque investissement

INSTRUCTIONS:
1. R√©ponds de mani√®re concise et professionnelle en fran√ßais
2. Utilise des emojis avec mod√©ration
3. Guide l'utilisateur vers l'action appropri√©e selon son parcours
4. Mets en avant les b√©n√©fices concrets: gain de temps, r√©duction des co√ªts, augmentation des revenus
5. Si l'utilisateur semble pr√™t, sugg√®re une consultation gratuite
6. Adapte ton message au contexte de navigation de l'utilisateur

Question: ${userMessage}`,
        response_json_schema: {
          type: "object",
          properties: {
            response: { type: "string" },
            suggestServices: { type: "boolean" },
            suggestContact: { type: "boolean" },
            suggestROI: { type: "boolean" },
            detectedInterest: { type: "string" }
          }
        }
      });

      if (response.detectedInterest) {
        trackInterest(response.detectedInterest);
      }

      const nextReplies = [];
      if (response.suggestServices) {
        nextReplies.push({ text: "Voir les services", action: "services", icon: Briefcase });
      }
      if (response.suggestROI) {
        nextReplies.push({ text: "Calculer mon ROI", action: "roi", icon: Calculator });
      }
      if (response.suggestContact) {
        nextReplies.push({ text: "Parler √† un expert", action: "contact", icon: Mail });
      }

      setMessages(prev => [...prev, { 
        role: 'assistant', 
        content: response.response,
        quickReplies: nextReplies.length > 0 ? nextReplies : undefined,
        showContactButton: response.suggestContact
      }]);
    } catch (error) {
      setMessages(prev => [...prev, { 
        role: 'assistant', 
        content: "D√©sol√©, je rencontre un probl√®me technique. Vous pouvez nous contacter directement par email √† agency-leoservices@zohomailcloud.ca pour une assistance imm√©diate.",
        showContactButton: true
      }]);
    } finally {
      setIsLoading(false);
    }
  };

  const handleKeyPress = (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      handleSendMessage();
    }
  };

  return (
    <>
      {/* Chat Button */}
      <motion.button
        className="fixed bottom-6 right-6 z-50 w-16 h-16 rounded-full bg-[#00ff41] text-black shadow-[0_0_30px_rgba(0,255,65,0.5)] flex items-center justify-center hover:scale-110 transition-transform"
        onClick={() => setIsOpen(!isOpen)}
        whileHover={{ scale: 1.1 }}
        whileTap={{ scale: 0.95 }}
        initial={{ scale: 0 }}
        animate={{ scale: 1 }}
        transition={{ type: "spring", stiffness: 260, damping: 20 }}
      >
        <AnimatePresence mode="wait">
          {isOpen ? (
            <motion.div
              key="close"
              initial={{ rotate: -90, opacity: 0 }}
              animate={{ rotate: 0, opacity: 1 }}
              exit={{ rotate: 90, opacity: 0 }}
            >
              <X className="w-7 h-7" />
            </motion.div>
          ) : (
            <motion.div
              key="open"
              initial={{ rotate: 90, opacity: 0 }}
              animate={{ rotate: 0, opacity: 1 }}
              exit={{ rotate: -90, opacity: 0 }}
              className="relative"
            >
              <MessageCircle className="w-7 h-7" />
              {hasShownProactiveMessage && (
                <span className="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full animate-pulse" />
              )}
            </motion.div>
          )}
        </AnimatePresence>
      </motion.button>

      {/* Proactive message bubble */}
      <AnimatePresence>
        {hasShownProactiveMessage && !isOpen && (
          <motion.div
            initial={{ opacity: 0, y: 10, scale: 0.9 }}
            animate={{ opacity: 1, y: 0, scale: 1 }}
            exit={{ opacity: 0, y: 10, scale: 0.9 }}
            className="fixed bottom-24 right-6 z-40 max-w-xs bg-[#1a1a1a] border border-[#00ff41]/50 rounded-2xl p-4 shadow-lg cursor-pointer"
            onClick={() => setIsOpen(true)}
          >
            <p className="text-sm text-gray-200">
              üí° Besoin d'aide pour choisir la bonne solution d'automatisation?
            </p>
            <button 
              className="text-[#00ff41] text-sm font-semibold mt-2 flex items-center gap-1"
              onClick={() => setIsOpen(true)}
            >
              Discuter maintenant <ArrowRight className="w-3 h-3" />
            </button>
          </motion.div>
        )}
      </AnimatePresence>

      {/* Chat Window */}
      <AnimatePresence>
        {isOpen && (
          <motion.div
            initial={{ opacity: 0, y: 20, scale: 0.95 }}
            animate={{ opacity: 1, y: 0, scale: 1 }}
            exit={{ opacity: 0, y: 20, scale: 0.95 }}
            transition={{ type: "spring", stiffness: 300, damping: 30 }}
            className="fixed bottom-24 right-6 z-50 w-[400px] max-w-[calc(100vw-3rem)] h-[550px] max-h-[75vh] bg-[#0a0a0a] border border-[#00ff41]/50 rounded-2xl shadow-[0_0_50px_rgba(0,255,65,0.2)] flex flex-col overflow-hidden"
          >
            {/* Header */}
            <div className="bg-gradient-to-r from-[#00ff41]/20 to-[#00cc33]/20 border-b border-[#00ff41]/30 p-4">
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 rounded-full bg-[#00ff41] flex items-center justify-center">
                  <Bot className="w-6 h-6 text-black" />
                </div>
                <div>
                  <h3 className="font-bold text-white flex items-center gap-2">
                    Assistant IA
                    <Sparkles className="w-4 h-4 text-[#00ff41]" />
                  </h3>
                  <p className="text-xs text-[#00ff41]">En ligne ‚Ä¢ Votre guide personnalis√©</p>
                </div>
              </div>
            </div>

            {/* Messages */}
            <div className="flex-1 overflow-y-auto p-4 space-y-4">
              {messages.map((message, index) => (
                <div key={index}>
                  <div className={`flex gap-3 ${message.role === 'user' ? 'flex-row-reverse' : ''}`}>
                    <div className={`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${
                      message.role === 'user' 
                        ? 'bg-[#2a2a2a]' 
                        : 'bg-[#00ff41]'
                    }`}>
                      {message.role === 'user' 
                        ? <User className="w-4 h-4 text-gray-400" />
                        : <Bot className="w-4 h-4 text-black" />
                      }
                    </div>
                    <div className={`max-w-[80%] rounded-2xl px-4 py-3 ${
                      message.role === 'user'
                        ? 'bg-[#00ff41] text-black rounded-br-md'
                        : 'bg-[#1a1a1a] text-gray-200 rounded-bl-md border border-[#2a2a2a]'
                    }`}>
                      <p className="text-sm whitespace-pre-wrap">{message.content}</p>
                    </div>
                  </div>

                  {/* Navigation Button */}
                  {message.navigateTo && (
                    <div className="mt-3 ml-11">
                      <Button
                        size="sm"
                        className="bg-[#00ff41] text-black hover:bg-[#00cc33] text-xs"
                        asChild
                      >
                        <Link to={createPageUrl(message.navigateTo)}>
                          Voir la page
                          <ArrowRight className="w-3 h-3 ml-1" />
                        </Link>
                      </Button>
                    </div>
                  )}

                  {/* Quick Replies */}
                  {message.quickReplies && index === messages.length - 1 && !isLoading && (
                    <div className="flex flex-wrap gap-2 mt-3 ml-11">
                      {message.quickReplies.map((reply, i) => (
                        <button
                          key={i}
                          onClick={() => handleQuickReply(reply.action)}
                          className="flex items-center gap-1.5 px-3 py-1.5 text-xs bg-[#1a1a1a] text-[#00ff41] border border-[#00ff41]/30 rounded-full hover:bg-[#00ff41]/10 transition-colors"
                        >
                          {reply.icon && <reply.icon className="w-3 h-3" />}
                          {reply.text}
                        </button>
                      ))}
                    </div>
                  )}

                  {/* Contact Button */}
                  {message.showContactButton && !message.quickReplies && (
                    <div className="mt-3 ml-11">
                      <Button
                        size="sm"
                        className="bg-[#00ff41] text-black hover:bg-[#00cc33] text-xs"
                        onClick={() => handleQuickReply('contact')}
                      >
                        Parler √† un expert
                        <ArrowRight className="w-3 h-3 ml-1" />
                      </Button>
                    </div>
                  )}
                </div>
              ))}

              {/* Loading */}
              {isLoading && (
                <div className="flex gap-3">
                  <div className="w-8 h-8 rounded-full bg-[#00ff41] flex items-center justify-center flex-shrink-0">
                    <Bot className="w-4 h-4 text-black" />
                  </div>
                  <div className="bg-[#1a1a1a] rounded-2xl rounded-bl-md px-4 py-3 border border-[#2a2a2a]">
                    <div className="flex gap-1">
                      <span className="w-2 h-2 bg-[#00ff41] rounded-full animate-bounce" style={{ animationDelay: '0ms' }} />
                      <span className="w-2 h-2 bg-[#00ff41] rounded-full animate-bounce" style={{ animationDelay: '150ms' }} />
                      <span className="w-2 h-2 bg-[#00ff41] rounded-full animate-bounce" style={{ animationDelay: '300ms' }} />
                    </div>
                  </div>
                </div>
              )}

              <div ref={messagesEndRef} />
            </div>

            {/* Input */}
            <div className="p-4 border-t border-[#2a2a2a] bg-[#0f0f0f]">
              <div className="flex gap-2">
                <Input
                  ref={inputRef}
                  value={inputValue}
                  onChange={(e) => setInputValue(e.target.value)}
                  onKeyPress={handleKeyPress}
                  placeholder="Posez votre question..."
                  disabled={isLoading}
                  className="flex-1 bg-[#1a1a1a] border-[#2a2a2a] text-white placeholder:text-gray-500 focus:border-[#00ff41] focus:ring-[#00ff41]/20"
                />
                <Button
                  onClick={handleSendMessage}
                  disabled={!inputValue.trim() || isLoading}
                  className="bg-[#00ff41] text-black hover:bg-[#00cc33] disabled:opacity-50"
                >
                  {isLoading ? (
                    <Loader2 className="w-5 h-5 animate-spin" />
                  ) : (
                    <Send className="w-5 h-5" />
                  )}
                </Button>
              </div>
              <p className="text-[10px] text-gray-600 text-center mt-2">
                Propuls√© par Agency Leo Services IA
              </p>
            </div>
          </motion.div>
        )}
      </AnimatePresence>
    </>
  );
